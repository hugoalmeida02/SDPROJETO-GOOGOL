<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <title>Resultados da Pesquisa</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>

<body>
  <header>
    <h1>Resultados da Pesquisa</h1>
  </header>

  <main>
    <section id="tools">
      <button id="index-top-stories-btn">Indexar Top Stories do Hacker News</button>
      <button id="generate-analysis-btn">Gerar Análise da Pesquisa</button>
      <p id="tool-msg"></p>
    </section>
    <div id="analysis-container" style="display: none;">
        <h2>Análise Gerada:</h2>
        <p id="analysis-content">A gerar a tua resposta...</p>
    </div>
    <div id="results-container">
      {% if urls %}
      {% for item in urls %}
      <div class="result-item">
        <h3><a href="{{ item.url }}" target="_blank">{{ item.title }}</a></h3>
        <p>{{ item.snippet or item.url }}</p>
      </div>
      {% endfor %}
      {% else %}
      <p>Nenhum resultado encontrado.</p>
      {% endif %}
    </div>

    <div class="pagination">
      {% if current_page > 1 %}
      <a href="/search?words={{ words }}&page={{ current_page - 1 }}">← Anterior</a>
      {% endif %}
      <span>Página {{ current_page }} de {{ total_pages }}</span>
      {% if current_page < total_pages %} <a href="/search?words={{ words }}&page={{ current_page + 1 }}">Seguinte →</a>
        {% endif %}
    </div>
  </main>
  <script>
    document.getElementById("generate-analysis-btn").addEventListener("click", async function() {
            const searchTerms = "{{ words }}"; // Passa os termos do Jinja2 para o JavaScript
            
            try {
                // Adicionar a análise no início da página sem modificar o resto do conteúdo
                const analysisContainer = document.getElementById("analysis-container");
                const analysisContent = document.getElementById("analysis-content");

                // Mostrar a análise na página
                analysisContainer.style.display = "block";


                const response = await fetch("/generate_analysis", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ search_terms: searchTerms })
                });

                // Verifica se a resposta foi bem-sucedida
                if (!response.ok) {
                    analysisContent.textContent = "Erro ao gerar a análise"
                    throw new Error("Erro ao gerar a análise");
                }

                const data = await response.json();
                const analysisText = data.analysis;
                
                analysisContent.textContent = analysisText;
            } catch (error) {
                console.error("Erro ao gerar a análise:", error);
            }
        });
  </script>
</body>

</html>